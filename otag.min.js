/*   _             _
 o  | |        o  | |                o
_   |/   __,  _   |/   __  _  __    _    __
 |  |   /  | / |  |   |_/ / |/  |  / |  /  \
 |_/|__/\_/|/  |_/|__/|__/  |   |_/  |_/\__/
          /|
*         \|    2016-2018 ilgilenioÂ® 
*               Otag Framework 1.0.0
*               https://github.com/ilgilenio/Otag/wiki
*               Licensed under MIT
*/
var O,Otag=O={Chain:function(a){var b=this||null;return function(){var c=arguments;b=b||this;return new Promise(function(d,e){for(var f=a.shift().prom().apply(b,c),g;g=a.shift();)f=f.then(g)["catch"](e);f.then(d)["catch"](e)})}},resp:function(a,b){if("string"==typeof a){var c={};a=(c[a]=b,c)}var d=this||{};Object.defineProperties(d,Object.keys(a).reduce(function(b,c){var f=a[c];d[c]&&(d["_"+c]=d[c]);b[c]={get:function(){return this["_"+c]},set:function(a){a!=this[c]&&(f.call(this,a),this["_"+c]=a)}};
return b},{}));return d},ready:new Promise(function(a,b){document.addEventListener("DOMContentLoaded",function(){a(document.body)})}),_selector:function(a){var b=["div",/\.([0-9A-Za-z\u015f\u015e\u00fc\u00dc\u00f6\u00d6\u00e7\u00c7\u0130\u0131\u011f\u011e]+)/g,/\[([0-9A-Za-z.-_\u015f\u015e\u00fc\u00dc\u00f6\u00d6\u00e7\u00c7\u0130\u0131\u011f\u011e]+)="([0-9A-Za-z0-9.-_\u015f\u015e\u00fc\u00dc\u00f6\u00d6\u00e7\u00c7\u0130\u0131\u011f\u011e]+)"\]/g,/#([0-9A-Za-z.-_\u015f\u015e\u00fc\u00dc\u00f6\u00d6\u00e7\u00c7\u0130\u0131\u011f\u011e]+)/,
/[\$|\u20ba|\u20b8|\u20bc]([0-9A-Za-z\u015f\u015e\u00fc\u00dc\u00f6\u00d6\u00e7\u00c7\u0130\u0131\u011f\u011e]+)/,/:(\w+)/g].map(function(b,c){if("string"==typeof b)return b;for(var d=2==c?{}:[],e=[],h,k=-1;(h=b.exec(a))&&b.lastIndex!=k;)e.push(h[0]),k=b.lastIndex,2==c?d[h[1]]=h[2]:d.push(h[1]);e.forEach(function(b){a=a.replace(b,"")});return d});if(!isFinite(a)&&a.length&&-1==["[","#","."].indexOf(a[0])){var c=Math.min.apply(Math,["[","#","."].map(function(b){b=a.indexOf(b);return-1==b?Infinity:
b}));b[0]=a.substr(0,c);a=a.substring(c);-1=="otag h1 div svg a b i input button select option textarea script link img".split(" ").indexOf(b[0])&&(b[1].push(b[0]),b[0]="div")}return b},define:function(a,b){this[a]||(this[a]={});Object.keys(b).forEach(function(c){this[a][c]=b[c]},this)},_conf:{backend:"/"},Time:new Proxy({yesterday:864E5,today:0,now:0,tomorrow:-864E5},{get:function(a,b,c){a=new Date(+new Date-a[b]);"now"!=b&&(a.setHours(0),a.setMinutes(0),a.setSeconds(0));return Math.floor(a.getTime()/
1E3)}}),Disk:"undefined"!=typeof Storage?new Proxy({available:!0,rem:function(a){"string"==typeof a&&(a=[a]);a.forEach(function(a){localStorage.removeItem(a)})}},{get:function(a,b){if(a[b])return a[b];b=localStorage.getItem(b);try{return JSON.parse(b)}catch(c){return b}},set:function(a,b,c){localStorage.setItem(b,JSON.stringify(c));return!0},deleteProperty:function(a,b){return delete localStorage[b]},has:function(a,b){return localStorage[b]?!0:!1}}):{available:!1},combine:function(){var a=O.toArray(arguments),
b=a.shift();b instanceof Object||(b=b.init());return a.reduce(function(a,b){return Object.keys(b).reduce(function(a,c){a[c]=b[c];return a},a)},b)},req:function(a,b,c){var d=new XMLHttpRequest;d.open(b?"POST":"GET",-1<a.indexOf("/")?a:O._conf.backend+a,!0);d.setRequestHeader("Content-type","application/x-www-form-urlencoded");var e=function(a,b){var c=[],d;for(d in a)if(a.hasOwnProperty(d)){var f=b?b+"["+d+"]":d,g=a[d];c.push("object"==typeof g?e(g,f):encodeURIComponent(f)+"="+encodeURIComponent(g))}return c.join("&")};
return new Promise(function(a,c){d.onreadystatechange=function(){if(4==this.readyState)if(200==this.status)if(""!=this.response){try{var b=JSON.parse(this.response)}catch(k){b=this.response}a(b)}else c("");else c({error:{code:this.status}})};e=b?e(b):"";d.send(e)})},i18n:{_:{lang:null,map:null},get:function(a){var b=this;return new Promise(function(c,d){b.ready.then(function(){var e=Math.floor(a);a=Math.round(a%1*10);b._.phr[e]?c(b._.phr[e].split("=")[a]):d()})})},refresh:function(){"[phrase]".get().map(O.F.each("Lang"))},
ready:new Promise(function(a,b){var c=setInterval(function(){var b=O.i18n._;if(b.r?b.r==b.ranges.length:b.phr&&Object.keys(b.phr).length)clearInterval(c),a(1),b.div.value=b.lang},100)}),set:function(a){O.Disk._lang=a;document.body.Class("ar","ar"!=this.value);var b=this,c=b._,d=function(d){c.lang=a;O.Disk["_l"+c.lang+(this[1]||"")]=d;d=d.split("\n");b._.map&&(d=d.map(b._.map));d.forEach(function(a,b){c.phr[b+this]=a},this[0]||1);"net"==this[2]&&(d=O.Disk_lTime||Array.from({length:c.ranges.length}).map(function(){return 0}),
d[this[1]]=O.Time.now,O.Disk._lTime=d);c.r++;b.refresh()};b.refresh();c.phr=null;if(c.path){var e;c.phr={};(c.ranges||[1]).forEach(function(b,c){(e=O.Disk["_l"+a+(c||"")])?d.call([b,c],e):O.req(this.vars({lang:a,part:c})).then(d.bind([b,c,"net"]))},c.path)}else c.lang=a},init:function(a){a.ranges&&(a.r=0);O.combine(this._,a);var b;if(O.Disk._lTime&&(b="otag[i18n]".get()).length){b=b[0].attr("i18n");var c=O.Time.now;b=-1==b.indexOf(",")?Number(b):b.split(",").map(Number);var d=[];(a.ranges||[1]).forEach(function(e,
g){c<("number"==typeof b?b:b[g])&&(d=d.concat(Object.keys(a.langs).map(function(a){return"_l"+a+(g||"")})))});console.log(d);O.Disk.rem(d)}var e=O.Disk._lang||navigator.language.substr(0,2).toLowerCase();this.set(-1==Object.keys(this._.langs).indexOf(e)?"en":e);this._.div.prop({onchange:function(){O.i18n.set(this.value)}}).has(Object.keys(this._.langs).map(function(a,b){return"option".prop({value:a,selected:a==this[0]}).set(this[1][a])},[this.get(),this._.langs]))}},toArray:function(a){return(a._?
"string"==typeof a._?a._.split(","):a._:Object.keys(a)).map(function(b){return a[b]})},proto:{Element:{V:function(a){return(a||"").split(":").reduce(function(a,c){return a?""==c?a.View:a.View[c]?a.View[c]:null:null},this)},resp:function(a,b){return O.resp.call(this,a,b)},extend:function(a,b){if(O.UI[a])return O.UI[a].apply(this,b||[]);console.warn(a,"is not defined");return this},destroy:function(a,b){var c=this;return new Promise(function(d){setTimeout(function(){setTimeout(function(){c.remove();
d()},b||300);c.Class("destroy")},a||0)})},interval:function(a,b,c){this._interval&&clearInterval(this._interval);if("passive"==a)return this;"function"==typeof a&&(this.__interval=[function(b,c){a.apply(b,c||[])},b,this,c],this.__iParams=[a,c||[],b]);this._interval=setInterval.apply(window,this.__interval);this.__iParams[0].apply(this,this.__iParams[1]);return this},disp:function(a){a||this.hasOwnProperty("dispState")||(this.dispState=this.style.display);this.style.display=a?this.dispState:"none";
return this},prop:function(a,b,c){if(null==b&&!(a instanceof Object)||a instanceof Array)if(a instanceof Array){var d={};a.map(function(a){d[a]=c?this.getAttribute(a):this[a]},this)}else d=c?this.getAttribute(a):this[a];else if(d=this,c){if(!(a instanceof Object)){var e={};a=(e[a]=b,e)}Object.keys(a).forEach(function(b){d.setAttribute(b,a[b])})}else a instanceof Object?(Object.keys(a).forEach(function(b){"function"==typeof a[b]&&(a[b]=a[b].bind(d))}),O.combine(this,a)):this[a]=b;return d},Class:function(a,
b){a instanceof Array||(a=[a]);this.className=a.reduce(function(a,d){a=a.replace(new RegExp("(\\b"+d+")+"),"");return(b?a:a+" "+d).replace(/\s{2}/g," ").trim()},this.className);return this},layout:function(a,b){var c=b||this;this.innerHTML="";return this.append(a.map(function(a){return a instanceof Element?a:a instanceof Array?a[0].layout(a[1],c):c.V(a)||a.init()}))},append:function(a,b){a&&(a instanceof Array?a[0]instanceof Array&&(a=a.map(function(a){return"d".append(a)})):a=[a],b&&(a=a.reverse()),
a.forEach(function(a){a instanceof Element||(a=a.init());this.appendChild(a)},this));return this},has:function(a,b){if(a){this._fingerprint=O.randKey(3);this.View||(this.View={});if(a instanceof Array&&!(a[0]instanceof Element)){var c=[];for(i in a)c.push("d".has(a[i])),a[i].parent=this,O.combine(this.View,a[i]);a=c}if("object"!=typeof a||a instanceof Element)a=[a];a instanceof Object&&(a=(a._?"function"==typeof a._?Object.keys(a).filter(function(b){return a[b]instanceof Element}).sort(a._):a._:Object.keys(a)).map(function(b){"function"==
typeof a[b]&&(a[b]=a[b]());return this.View[b]=a[b].prop({parent:this})},this))}return this.append(a,b)},html:function(a){this.innerHTML="";return a?this.has.apply(this,arguments):this},Lang:function(a,b){a=a||this.attr("phrase")||this.prop("phrase");var c=this;c.attr("phrase",a);b&&c.prop("phr",b);var d=this.attr("t")||this.t;O.i18n.get(a).then(function(a){c.phr&&(c.phr instanceof Object||(c.phr=[c.phr]),a=a.vars(c.phr));c.ttl&&(c.title=a);-1<["title","placeholder"].indexOf(d)?c.attr(d,a):c.innerHTML=
a});return c},set:function(a,b){if(a&&!b){var c;(c=this.attr("phrase"))?(a instanceof Object||(a=[a]),this.phr=a,console.log(1),this.Lang(c,a)):a instanceof Object?(this.main||(this.main=this.innerHTML),this.innerHTML=this.main.vars(this.data=a)):this.innerHTML=a}else a&&(isFinite(a)?this.Lang(a,1==b?null:b):(this.main=a,this.innerHTML=this.main.vars(this.data=b)));return this.Class("def",1)},setView:function(a){var b=this.View;if(this.ondata)this.ondata(a);(a._||Object.keys(a)).forEach(function(c){b.hasOwnProperty(c)&&
b[c].set(a[c])});return this},attr:function(a,b){return this.prop.apply(this,[a,b,"attr"])}},String:{get:function(){var a=O._selector(this+"");if(a[4].length||a[5].length)throw Error("Module and argument selector is not available");var b=O.toArray(document.querySelectorAll(this+""));a[3].length&&(b=b[0]);return b},init:function(){var a=this+"",b=O._selector(a);if(b[4].length){var c=b[4][0];O.UI[c]||console.log(c,"is not defined");b[0]=O.UI[c].apply(c,b[5].length?b[5].concat(O.toArray(arguments)):
arguments)}else b[0]=document.createElement(b[0]);isFinite(a)&&""!=a&&O.i18n&&b[0].set(a,1).Class("label");b[1].length&&b[0].Class(b[1]);b[2]instanceof Object&&b[0].attr(b[2]);b[3].length&&(b[0].id=b[3][0]);return b[0]},extend:function(){var a=(this+"").get();return a instanceof Array?a.map(O.F.each("extend",O.toArray(arguments))):a.extend.apply(a,arguments)},from:function(a){var b=this.split(",").map(function(b){return a[b]});return 1==b.length?b[0]:b},of:function(a){var b=a.val;a=this.split(",").map(function(a){return b[a]});
return 1==a.length?a[0]:a},vars:function(a){a="object"==typeof a?a:arguments;return Object.keys(a).reduce(function(b,c){return b.replace(new RegExp("("+c+"[\u20ba|$|\u20b8|\u20bc])+"),a[c])},this)}},Function:{prom:function(){var a=this;return function(){var b=arguments;return new Promise(function(c,d){try{var e=a.apply(a,b);c(e)}catch(f){d(f)}})}},debounce:function(a){var b=this,c;return function(){var d=arguments,e=this;clearTimeout(c);c=setTimeout(function(){b.apply(e,d)},a);return e}}},Image:{set:function(a){this.src=
a;return this},value:function(){return this.src}}}};
O.F={diff:function(a){return function(b){return 0>a.indexOf(b)}},arrHas:function(a){return function(b){return-1<a.indexOf(b)}},num:function(a,b){a instanceof Array&&(b=a[1],a=a[0]);return function(c){return(!a||c>a)&&(!b||c<b)}},hasProp:function(a){return function(b){return a.hasOwnProperty(b)}},reg:function(a){a=new RegExp(a);return function(b){return a.test(b)}},pref:function(a){var b=a.length;return function(c){return c.substring(0,b)==a}},eq:function(a,b,c,d){return 1==arguments.length?function(b){return b==
a}:d?function(e){return d(e[c](a))==b}:function(d){return(c=d[a])==b}},unique:function(a,b,c){return c.indexOf(a)===b},value:function(a,b,c){c=c?"attr":"prop";return b?function(d){return b(d[c](a))}:function(b){return b[c](a)}},each:function(a,b){b instanceof Array||(b=[b]);return function(c){if(c[a])return c[a].apply(c,b)}}};O.UI={M:function(a){var b=O.toArray(arguments);return O.Model[b.shift()].apply("",b)}};Otag.Model={Default:function(a){var b={};Object.keys(a).forEach(function(a){b[a]=a});return"defaultModel".has(b).setView(a)}};
Object.keys(O.proto).forEach(function(a){O.combine(window[a].prototype||window[a],O.proto[a])});Object.keys(O.proto.Element).forEach(function(a){Number.prototype[a]=String.prototype[a]=function(){var b=this.init();return b[a].apply(b,arguments)}});delete O.proto;
Object.defineProperties(Element.prototype,{val:{get:function(){if("function"==typeof this.value)return this.value();if(this.value||this.hasOwnProperty("value"))return this.value;if(this.View){var a={},b=this;Object.keys(this.View).forEach(function(c){"_"==c[0]||this[c].isSameNode(b)||(a[c]=this[c].val)},this.View);return a}return this.data||null},set:function(a){this.View?this.setView(a):this.set(a)}}});